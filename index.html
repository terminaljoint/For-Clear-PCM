<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>For Clear PCM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0b0f14;--panel:#121821;--border:#1f2937;
  --text:#e5e7eb;--muted:#9ca3af;--accent:#3b82f6;--ok:#22c55e;--warn:#eab308;--bad:#ef4444;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,system-ui;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid var(--border);background:#0b1220;position:sticky;top:0;z-index:5}
.brand{font-weight:800;font-size:1.1rem}
.tag{font-size:.7rem;color:var(--muted)}
.hud{display:flex;gap:10px;align-items:center;font-size:.65rem}
.badge{padding:3px 8px;border-radius:999px;border:1px solid var(--border)}
.badge.owner{color:var(--accent)}
main{flex:1;display:grid;grid-template-columns:260px 1fr;min-height:0}
.sidebar{border-right:1px solid var(--border);background:#0c1320;overflow:auto}
.sidebar h3{font-size:.75rem;color:var(--muted);padding:10px 12px}
.subjects button{width:100%;text-align:left;padding:10px 12px;border:none;background:none;color:var(--text);cursor:pointer;font-size:.8rem}
.subjects button.active{background:#111827;color:var(--accent)}
.content{overflow:auto;padding:16px}
.pathbar{font-size:.7rem;color:var(--muted);margin-bottom:10px}
.pathbar span{cursor:pointer;color:var(--accent)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px;cursor:pointer}
.card:hover{border-color:var(--accent)}
.editor{margin-top:16px;background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:12px}
.editor textarea{width:100%;min-height:220px;background:#0b1220;border:1px solid var(--border);color:var(--text);border-radius:8px;padding:10px;font-size:.75rem}
footer{border-top:1px solid var(--border);padding:8px;text-align:center;font-size:.6rem;color:var(--muted)}
</style>
</head>
<body>
<header>
  <div>
    <div class="brand">For Clear PCM</div>
    <div class="tag">Ultra-deep JEE knowledge system</div>
  </div>
  <div class="hud">
    <div id="ownerBadge" class="badge owner" style="display:none">EDITOR</div>
  </div>
</header>
<main>
  <aside class="sidebar">
    <h3>Subjects</h3>
    <div class="subjects" id="subjects"></div>
  </aside>
  <section class="content">
    <div class="pathbar" id="pathbar">Select a subject</div>
    <div id="grid" class="grid"></div>
    <div id="editor"></div>
  </section>
</main>
<footer>©2026 Terminal Joint · For Clear PCM</footer>

<!-- Firebase (v9 modular) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ================= FIREBASE CONFIG ================= */
const firebaseConfig = {
  apiKey: "AIzaSyAPzgwYDQQqR4y8aRcu8BmXfhYoLPXDuVM",
  authDomain: "forclearpcm.firebaseapp.com",
  projectId: "forclearpcm",
  storageBucket: "forclearpcm.firebasestorage.app",
  messagingSenderId: "313585574692",
  appId: "1:313585574692:web:d4e1262ce22c7cd0bb89b1",
};

const OWNER_UID = "4MXKQ1JnnIUARfdYlIUbD0Q4erD2";

/* ================= INIT ================= */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const provider = new GoogleAuthProvider();

/* ================= CORE DATA (UNCHANGED) ================= */
const syllabus = window.syllabus || {};

/* ================= STATE ================= */
let path = [];
let OWNER = false;

const subjectsDiv = document.getElementById('subjects');
const grid = document.getElementById('grid');
const pathbar = document.getElementById('pathbar');
const editor = document.getElementById('editor');
const ownerBadge = document.getElementById('ownerBadge');

/* ================= AUTH ================= */
onAuthStateChanged(auth, async user => {
  if(!user){ await signInWithPopup(auth, provider); return; }
  OWNER = user.uid === OWNER_UID;
  ownerBadge.style.display = OWNER ? 'inline-block' : 'none';
  render();
});

/* ================= HELPERS ================= */
function getNode(){
  let n = syllabus;
  for(const k of path){ if(!n[k]) return null; n = n[k]; }
  return n;
}
function isLeaf(node){ return typeof node === 'object' && Object.keys(node).length === 0; }

/* ================= RENDER ================= */
function renderSubjects(){
  subjectsDiv.innerHTML='';
  Object.keys(syllabus).forEach(s=>{
    const b=document.createElement('button');
    b.textContent=s;
    if(path[0]===s) b.classList.add('active');
    b.onclick=()=>{ path=[s]; render(); };
    subjectsDiv.appendChild(b);
  });
}

function renderPath(){
  if(path.length===0){ pathbar.textContent='Select a subject'; return; }
  pathbar.innerHTML='';
  path.forEach((p,i)=>{
    const sp=document.createElement('span');
    sp.textContent=p;
    sp.onclick=()=>{ path=path.slice(0,i+1); render(); };
    pathbar.appendChild(sp);
    if(i<path.length-1) pathbar.appendChild(document.createTextNode(' › '));
  });
}

async function renderGrid(){
  grid.innerHTML=''; editor.innerHTML='';
  const node = getNode();
  if(!node) return;

  if(isLeaf(node)){
    const ed=document.createElement('div');
    ed.className='editor';
    if(OWNER){
      const ta=document.createElement('textarea');
      ta.placeholder='Owner-only content';
      ed.appendChild(ta);
    } else {
      ed.textContent='Locked content';
    }
    editor.appendChild(ed);
    return;
  }

  Object.keys(node).forEach(k=>{
    const c=document.createElement('div');
    c.className='card';
    c.innerHTML=`<div class="title">${k}</div>`;
    c.onclick=()=>{ path.push(k); render(); };
    grid.appendChild(c);
  });
}

function render(){
  if(!Array.isArray(path)) path = [];
  renderSubjects();
  renderPath();
  renderGrid();
}

render();
</script>
</body>
</html>
