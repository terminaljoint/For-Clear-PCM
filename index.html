<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>For Clear PCM – Firebase Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:"Comic Neue",system-ui;background:#0d1117;color:#e6edf3;min-height:100vh;display:flex;flex-direction:column}
header{padding:22px 24px;border-bottom:1px solid #30363d}
.brand{font-size:2rem;font-weight:700}
.subtitle{color:#9aa4af;margin-top:6px}
.subject-bar{display:flex;gap:12px;padding:14px 24px;border-bottom:1px solid #30363d}
.subject-btn{padding:8px 16px;border:1px solid #30363d;border-radius:10px;cursor:pointer;font-weight:700}
.subject-btn.active{border-color:#2f81f7;color:#2f81f7}
main{max-width:1100px;margin:0 auto;padding:32px 24px;flex:1}
.item{padding:14px 16px;border:1px solid #30363d;border-radius:10px;margin-bottom:12px;cursor:pointer}
.item:hover{border-color:#2f81f7}
.back{margin-bottom:14px;color:#2f81f7;cursor:pointer}
footer{border-top:1px solid #30363d;padding:16px 24px;font-size:.85rem;color:#9aa4af;text-align:center}
textarea,input,select,button{width:100%;background:#0d1117;color:#e6edf3;border:1px solid #30363d;border-radius:8px;padding:10px;margin-top:8px}
button{cursor:pointer;font-weight:700}
#loginBox{border:1px solid #30363d;border-radius:10px;padding:16px;margin-bottom:20px}
#lockBadge{color:#f85149;font-weight:700}
</style>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ===== FIREBASE CONFIG ===== */
const firebaseConfig = {
  apiKey: "AIzaSyAPzgwYDQQqR4y8aRcu8BmXfhYoLPXDuVM",
  authDomain: "forclearpcm.firebaseapp.com",
  projectId: "forclearpcm",
  storageBucket: "forclearpcm.firebasestorage.app",
  messagingSenderId: "313585574692",
  appId: "1:313585574692:web:d4e1262ce22c7cd0bb89b1"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
const db = getFirestore(app);

/* ===== SYLLABUS TREE (STRUCTURE ONLY) ===== */
const syllabus = {
  Maths:{ Sets:{ Operations:{ DeMorgan:{} } } },
  Physics:{ Kinematics:{ OneD:{}, TwoD:{} } },
  Chemistry:{ Physical:{ MoleConcept:{} }, Organic:{}, Inorganic:{} }
};

let path=[];
const OWNER_UIDS = ["NbJq7HLBt0Pd7O55f4u82HTWOyu2","4MXKQ1JnnIUARfdYlIUbD0Q4erD2"]; 
let OWNER=false;
let view=document.getElementById("view");

const isLeaf=n=>typeof n!=="object";
const getNode=()=>path.reduce((o,k)=>o[k],syllabus);

function setActive(){
  document.querySelectorAll('.subject-btn').forEach(b=>
    b.classList.toggle('active', path[0]===b.dataset.sub)
  );
}

/* ===== FIRESTORE IO ===== */
async function loadNode(p){
  const ref = doc(db,'syllabus',p[0]);
  const snap = await getDoc(ref);
  if(!snap.exists()) return null;
  return snap.data().nodes?.[p.join('/') ] || null;
}

async function saveNode(p,content,status){
  const ref = doc(db,'syllabus',p[0]);
  await setDoc(ref,{ nodes:{ [p.join('/')]:{content,status} } },{merge:true});
}

/* ===== RENDER ===== */
async function render(){
  view.innerHTML="";
  setActive();

  if(path.length){
    const b=document.createElement('div');
    b.className='back';
    b.innerText='← Back';
    b.onclick=()=>{path.pop();render();};
    view.appendChild(b);
  }

  if(!path.length){
    view.innerHTML+=`<h2>Welcome to For Clear PCM</h2><p class='subtitle'>Firebase-powered JEE knowledge system</p>`;
    return;
  }

  const node=getNode();

  if(isLeaf(node)){
    const data = await loadNode(path) || {content:'',status:'empty'};
    view.innerHTML+=`<h2>${path[path.length-1]}</h2><div>Status: <b>${data.status}</b></div>`;

    if(OWNER){
      const sel=document.createElement('select');
      ['empty','draft','done','revised'].forEach(s=>{
        const o=document.createElement('option');o.value=o.text=s;if(s===data.status)o.selected=true;sel.appendChild(o);
      });
      view.appendChild(sel);

      const ta=document.createElement('textarea');
      ta.value=data.content;
      view.appendChild(ta);

      ta.oninput=()=>saveNode(path,ta.value,sel.value);
      sel.onchange=()=>saveNode(path,ta.value,sel.value);

    } else {
      view.innerHTML+= data.content ? `<pre>${data.content}</pre>` : `<div id='lockBadge'>No content yet</div>`;
    }
    return;
  }

  Object.keys(node).forEach(k=>{
    const d=document.createElement('div');
    d.className='item';
    d.innerText=k;
    d.onclick=()=>{path.push(k);render();};
    view.appendChild(d);
  });
}

/* ===== AUTH UI ===== */
document.getElementById('loginBtn').onclick=()=>{
  signInWithPopup(auth, provider).catch(()=>alert('Google login failed'));
};
  const p=document.getElementById('password').value;
  signInWithEmailAndPassword(auth,e,p).catch(()=>alert('Login failed'));
};

document.getElementById('logoutBtn').onclick=()=>signOut(auth);

onAuthStateChanged(auth,user=>{
  OWNER = !!user && OWNER_UIDS.includes(user.uid);
  document.getElementById('loginBox').style.display=user?'none':'block';
  document.getElementById('logoutBtn').style.display=user?'block':'none';
  render();
});

/* ===== INIT ===== */
document.querySelectorAll('.subject-btn').forEach(b=>b.onclick=()=>{path=[b.dataset.sub];render();});
render();
</script>
</head>
<body>
<header><h1 class="brand">For Clear PCM</h1><p class="subtitle">Firebase Edition</p></header>

<div class="subject-bar">
  <div class="subject-btn" data-sub="Maths">Maths</div>
  <div class="subject-btn" data-sub="Physics">Physics</div>
  <div class="subject-btn" data-sub="Chemistry">Chemistry</div>
</div>

<main>
  <div id="loginBox">
    <h3>Owner Login</h3>
    <button id="loginBtn">Login with Google</button>
  </div>
  <button id="logoutBtn" style="display:none">Logout</button>
  <div id="view"></div>
</main>

<footer>©2026 Terminal Joint · For Clear PCM</footer>
</body>
</html>
