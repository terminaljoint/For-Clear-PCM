<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>For Clear PCM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0b0f14;--panel:#121821;--border:#1f2937;
  --text:#e5e7eb;--muted:#9ca3af;--accent:#3b82f6;--green:#22c55e;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}

header{
  padding:14px 18px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.brand{font-weight:800}
.mode{font-size:.7rem;color:var(--muted)}

main{flex:1;max-width:1100px;margin:auto;padding:16px}

.pathbar{
  font-size:.75rem;
  color:var(--muted);
  margin-bottom:12px;
}
.pathbar span{color:var(--accent);cursor:pointer}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:12px;
}

.card{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  cursor:pointer;
}
.card:hover{border-color:var(--accent)}
.card b{font-size:.85rem}

.viewer{
  margin-top:20px;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:16px;
  white-space:pre-wrap;
  line-height:1.6;
}

.editor{
  margin-top:20px;
  background:#020617;
  border:2px solid var(--green);
  border-radius:14px;
  padding:16px;
}
.editor h3{font-size:.85rem;color:var(--green);margin-bottom:8px}
.editor textarea{
  width:100%;
  min-height:260px;
  background:#020617;
  color:var(--text);
  border:1px solid var(--border);
  border-radius:10px;
  padding:12px;
  font-size:.8rem;
}

.top-actions button{
  background:#111827;
  border:1px solid var(--border);
  color:var(--text);
  padding:6px 10px;
  border-radius:8px;
  cursor:pointer;
}

footer{
  border-top:1px solid var(--border);
  padding:8px;
  text-align:center;
  font-size:.6rem;
  color:var(--muted);
}
</style>
</head>

<body>
<header>
  <div>
    <div class="brand">For Clear PCM</div>
    <div class="mode" id="mode">VIEW MODE</div>
  </div>
  <div class="top-actions">
    <button id="loginBtn">Google Login</button>
    <button id="logoutBtn" style="display:none">Logout</button>
  </div>
</header>

<main>
  <div class="pathbar" id="pathbar"></div>
  <div class="grid" id="grid"></div>
  <div id="content"></div>
</main>

<footer>©2026 Terminal Joint · For Clear PCM</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAPzgwYDQQqR4y8aRcu8BmXfhYoLPXDuVM",
  authDomain: "forclearpcm.firebaseapp.com",
  projectId: "forclearpcm",
  storageBucket: "forclearpcm.appspot.com",
  messagingSenderId: "313585574692",
  appId: "1:313585574692:web:d4e1262ce22c7cd0bb89b1"
};

const OWNER_UIDS=[
  "NbJq7HLBt0Pd7O55f4u82HTWOyu2",
  "4MXKQ1JnnIUARfdYlIUbD0Q4erD2"
];

const syllabus={ Maths:{Algebra:{Quadratic_Equations:{Discriminant:{D_Positive:{},D_Zero:{}}}}} };

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);
const provider=new GoogleAuthProvider();

let path=[],user=null,isOwner=false;

const grid=document.getElementById("grid");
const pathbar=document.getElementById("pathbar");
const content=document.getElementById("content");
const mode=document.getElementById("mode");

document.getElementById("loginBtn").onclick=()=>signInWithPopup(auth,provider);
document.getElementById("logoutBtn").onclick=()=>signOut(auth);

onAuthStateChanged(auth,u=>{
  user=u;
  isOwner=!!u && OWNER_UIDS.includes(u.uid);
  mode.textContent=isOwner?"OWNER EDIT MODE":"VIEW MODE";
  document.getElementById("loginBtn").style.display=u?"none":"inline-block";
  document.getElementById("logoutBtn").style.display=u?"inline-block":"none";
  render();
});

function getNode(){
  let n=syllabus;
  for(const p of path){ n=n[p]; }
  return n;
}
function isLeaf(n){ return Object.keys(n).length===0; }
function key(){ return path.join("/"); }

async function load(){
  const snap=await getDoc(doc(db,"content",key()));
  return snap.exists()?snap.data().text:"";
}
async function save(text){
  if(isOwner) await setDoc(doc(db,"content",key()),{text});
}

function render(){
  grid.innerHTML=""; content.innerHTML=""; pathbar.innerHTML="";
  path.forEach((p,i)=>{
    const s=document.createElement("span");
    s.textContent=p;
    s.onclick=()=>{path=path.slice(0,i+1);render()};
    pathbar.appendChild(s);
    if(i<path.length-1) pathbar.append(" › ");
  });

  const node=getNode();
  if(isLeaf(node)){
    load().then(t=>{
      if(isOwner){
        content.innerHTML=`<div class="editor"><h3>Owner Editor</h3><textarea>${t}</textarea></div>`;
        content.querySelector("textarea").oninput=e=>save(e.target.value);
      }else{
        content.innerHTML=`<div class="viewer">${t||"No content yet"}</div>`;
      }
    });
    return;
  }

  Object.keys(node).forEach(k=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<b>${k}</b>`;
    c.onclick=()=>{path.push(k);render()};
    grid.appendChild(c);
  });
}

render();
</script>
</body>
</html>
