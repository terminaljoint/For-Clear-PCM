<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>For Clear PCM – Structured JEE Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0d1117;
  --panel:#161b22;
  --border:#30363d;
  --text:#e6edf3;
  --muted:#9aa4af;
  --accent:#2f81f7;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,system-ui;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;font-size:13px}

header{padding:10px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.brand{font-size:1.2rem;font-weight:800;line-height:1}
.tag{color:var(--muted);font-size:.7rem}

#editorBadge{background:#238636;color:#fff;padding:3px 8px;border-radius:999px;font-size:.6rem;font-weight:600;display:none}

.subject-bar{display:flex;gap:6px;padding:6px 10px;border-bottom:1px solid var(--border)}
.subject-btn{padding:4px 10px;border:1px solid var(--border);border-radius:8px;cursor:pointer;font-weight:600;background:var(--panel);font-size:.75rem}
.subject-btn.active{border-color:var(--accent);color:var(--accent)}

main{display:grid;grid-template-columns:200px 1fr;flex:1;min-height:0}

.sidebar{border-right:1px solid var(--border);padding:8px;overflow:auto}
.sidebar h3{font-size:.65rem;color:var(--muted);margin-bottom:6px;letter-spacing:.05em}
.node{padding:4px 6px;border-radius:6px;cursor:pointer;margin-bottom:1px;font-size:.75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.node:hover{background:var(--panel)}
.node.active{background:var(--panel);border-left:2px solid var(--accent)}
.node.depth-1{padding-left:10px}
.node.depth-2{padding-left:18px}
.node.depth-3{padding-left:26px}
.node.depth-4{padding-left:34px}
.node.depth-5{padding-left:42px}

.content{padding:12px;overflow:auto}
.content h1{font-size:1rem;margin-bottom:4px}
.content .meta{color:var(--muted);font-size:.65rem;margin-bottom:8px}

textarea,select,button{width:100%;background:var(--panel);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:6px;font-size:.75rem}
textarea{min-height:160px;line-height:1.4}
button.primary{background:var(--accent);border:none;font-weight:700}

#loginBox{max-width:260px;margin:30px auto;padding:14px;border:1px solid var(--border);border-radius:12px;background:var(--panel)}
#loginBox h2{text-align:center;margin-bottom:6px;font-size:.9rem}
#loginBox p{text-align:center;color:var(--muted);font-size:.7rem;margin-bottom:10px}

footer{border-top:1px solid var(--border);padding:6px;text-align:center;font-size:.6rem;color:var(--muted)}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig={apiKey:"AIzaSyAPzgwYDQQqR4y8aRcu8BmXfhYoLPXDuVM",authDomain:"forclearpcm.firebaseapp.com",projectId:"forclearpcm",storageBucket:"forclearpcm.firebasestorage.app",messagingSenderId:"313585574692",appId:"1:313585574692:web:d4e1262ce22c7cd0bb89b1"};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const provider=new GoogleAuthProvider();
const db=getFirestore(app);

const OWNER_UIDS=["NbJq7HLBt0Pd7O55f4u82HTWOyu2","4MXKQ1JnnIUARfdYlIUbD0Q4erD2"];

const syllabus={
Maths:{
  Sets_and_Relations:{
    Sets:{Definition:{},Types:{},Subsets:{},Operations:{},Laws:{}},
    Relations:{Types:{},Functions:{Domain:{},Range:{},Types:{}}}
  },
  Algebra:{
    Quadratic_Equations:{},
    Sequences_and_Series:{AP:{},GP:{},HP:{}},
    Permutations_and_Combinations:{},
    Binomial_Theorem:{},
    Matrices_and_Determinants:{},
    Complex_Numbers:{},
    Probability:{}
  },
  Coordinate_Geometry:{
    Straight_Lines:{},
    Circles:{},
    Parabola:{},
    Ellipse:{},
    Hyperbola:{}
  },
  Calculus:{
    Limits:{},
    Continuity_and_Differentiability:{},
    Differentiation:{},
    Applications_of_Derivatives:{},
    Integration:{},
    Differential_Equations:{},
    Area_under_Curves:{}
  },
  Vectors_and_3D:{
    Vectors:{},
    Three_D_Geometry:{}
  }
},
Physics:{
  Kinematics:{},
  Laws_of_Motion:{},
  Work_Energy_Power:{},
  Rotational_Mechanics:{},
  Gravitation:{},
  Properties_of_Matter:{},
  Thermodynamics:{},
  Oscillations_and_Waves:{},
  Electrostatics:{},
  Current_Electricity:{},
  Magnetism_and_Matter:{},
  Electromagnetic_Induction:{},
  Alternating_Current:{},
  Electromagnetic_Waves:{},
  Optics:{Ray_Optics:{},Wave_Optics:{}},
  Modern_Physics:{
    Dual_Nature:{},
    Atoms_and_Nuclei:{},
    Semiconductor_Devices:{}
  }
},
Chemistry:{
  Physical:{
    Mole_Concept:{},
    Atomic_Structure:{},
    Chemical_Bonding:{},
    Thermodynamics:{},
    Redox_Reactions:{},
    Chemical_Kinetics:{},
    Electrochemistry:{},
    Solutions:{},
    Surface_Chemistry:{}
  },
  Inorganic:{
    Periodic_Table:{},
    Hydrogen:{},
    s_Block:{},
    p_Block:{},
    d_and_f_Block:{},
    Coordination_Compounds:{},
    Metallurgy:{}
  },
  Organic:{
    GOC:{},
    Hydrocarbons:{},
    Haloalkanes_and_Haloarenes:{},
    Alcohols_Phenols_Ethers:{},
    Aldehydes_Ketones_Carboxylic_Acids:{},
    Amines:{},
    Biomolecules:{},
    Polymers:{},
    Chemistry_in_Everyday_Life:{}
  }
}
};

let OWNER=false;
// Editable only at true terminal nodes AND sufficient depth
const isTerminalNode = (node) => typeof node === 'object' && Object.keys(node).length === 0;
const MIN_EDIT_DEPTH = 3;
let currentSubject=null;
let currentPath=[];

window.addEventListener('DOMContentLoaded',()=>{
  const sidebar=document.getElementById('sidebar');
  const content=document.getElementById('content');
  const badge=document.getElementById('editorBadge');

  function pushHistory(){
    history.pushState({subject:currentSubject,path:[...currentPath]},"",`#${currentSubject||''}/${currentPath.slice(1).join('/')}`);
  }

  window.addEventListener('popstate',e=>{
    if(e.state){
      currentSubject=e.state.subject;
      currentPath=e.state.path||[];
      render();
    }
  });

  function renderSidebarRecursive(node,path=[],depth=0){
    Object.keys(node).forEach(k=>{
      const fullPath=[...path,k];
      const d=document.createElement('div');
      d.className=`node depth-${depth}`+(fullPath.join('/')===currentPath.join('/')?' active':'');
      d.innerText=k;
      d.onclick=()=>{currentSubject=fullPath[0];currentPath=fullPath;pushHistory();render();};
      sidebar.appendChild(d);
      if(typeof node[k]==='object'){
        renderSidebarRecursive(node[k],fullPath,depth+1);
      }
    });
  }

  async function loadNode(path){
    const ref=doc(db,'syllabus',path[0]);
    const snap=await getDoc(ref);
    return snap.exists()?snap.data().nodes?.[path.join('/')]||null:null;
  }

  async function saveNode(path,content,status){
    const ref=doc(db,'syllabus',path[0]);
    await setDoc(ref,{nodes:{[path.join('/')]:{content,status}}},{merge:true});
  }

  async function render(){
    sidebar.innerHTML='<h3>SYLLABUS</h3>';

    if(!currentSubject){
      renderSidebarRecursive(syllabus,[],0);
      content.innerHTML='<h1>For Clear PCM</h1><p class="meta">Select a subject or use browser back/forward safely.</p>';
      return;
    }

    renderSidebarRecursive(syllabus,[],0);

    let node=syllabus[currentSubject];
    for(let i=1;i<currentPath.length;i++) node=node[currentPath[i]];

    if(!isTerminalNode(node) || currentPath.length < MIN_EDIT_DEPTH){
      content.innerHTML='<h1>'+currentPath[currentPath.length-1]+'</h1><p class="meta">Navigate deeper</p>';
      return;
    }

    // Only deepest nodes can load content
const data = await loadNode(currentPath) || {content:'',status:'empty'};
    content.innerHTML=`<h1>${currentPath[currentPath.length-1]}</h1><div class='meta'>Status: ${data.status}</div>`;

    if(OWNER){
      const sel=document.createElement('select');
      ['empty','draft','done','revised'].forEach(s=>{const o=document.createElement('option');o.value=o.text=s;if(s===data.status)o.selected=true;sel.appendChild(o);});
      const ta=document.createElement('textarea');ta.value=data.content;
      ta.oninput=()=>saveNode(currentPath,ta.value,sel.value);
      sel.onchange=()=>saveNode(currentPath,ta.value,sel.value);
      content.appendChild(sel);content.appendChild(ta);
    } else {
      content.innerHTML+= data.content?`<pre>${data.content}</pre>`:`<p class='meta'>No content yet</p>`;
    }
  }

  document.querySelectorAll('.subject-btn').forEach(b=>b.onclick=()=>{currentSubject=b.dataset.sub;currentPath=[b.dataset.sub];pushHistory();render();});
  document.getElementById('loginBtn').onclick=()=>signInWithPopup(auth,provider);
  document.getElementById('logoutBtn').onclick=()=>signOut(auth);

  onAuthStateChanged(auth,user=>{
    OWNER=!!user&&OWNER_UIDS.includes(user.uid);
    badge.style.display=OWNER?'inline-block':'none';
    document.getElementById('loginBox').style.display=user?'none':'block';
    document.getElementById('logoutBtn').style.display=user?'block':'none';
    render();
  });

  render();
});
</script>
</head>
<body>
<header>
  <div>
    <div class="brand">For Clear PCM</div>
    <div class="tag">Structured JEE Learning · Firebase Powered</div>
  </div>
  <div id="editorBadge">EDITOR MODE</div>
</header>

<div class="subject-bar">
  <div class="subject-btn" data-sub="Maths">Maths</div>
  <div class="subject-btn" data-sub="Physics">Physics</div>
  <div class="subject-btn" data-sub="Chemistry">Chemistry</div>
</div>

<main>
  <aside class="sidebar" id="sidebar"></aside>
  <section class="content" id="content"></section>
</main>

<div id="loginBox">
  <h2>Owner Access</h2>
  <p>Only verified editors can modify content.</p>
  <button id="loginBtn" class="primary">Sign in with Google</button>
</div>

<button id="logoutBtn" style="display:none;margin:12px">Logout</button>

<footer>©2026 Terminal Joint · For Clear PCM</footer>
</body>
</html>
