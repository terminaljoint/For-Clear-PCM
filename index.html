<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>For Clear PCM â€“ Structured JEE Learning</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:"Comic Neue",system-ui;background:#0d1117;color:#e6edf3;min-height:100vh;display:flex;flex-direction:column}
header{padding:22px 24px;border-bottom:1px solid #30363d}
.brand{font-size:2rem;font-weight:700}
.subtitle{color:#9aa4af;margin-top:6px}
.subject-bar{display:flex;gap:12px;padding:14px 24px;border-bottom:1px solid #30363d}
.subject-btn{padding:8px 16px;border:1px solid #30363d;border-radius:10px;cursor:pointer;font-weight:700}
.subject-btn.active{border-color:#2f81f7;color:#2f81f7}
main{max-width:900px;margin:0 auto;padding:32px 24px;flex:1}
.item{padding:14px 16px;border:1px solid #30363d;border-radius:10px;margin-bottom:12px;cursor:pointer}
footer{border-top:1px solid #30363d;padding:16px 24px;font-size:.85rem;color:#9aa4af;text-align:center;cursor:pointer;user-select:none;-webkit-user-select:none}
#lockBadge{color:#f85149;font-weight:700;margin-top:12px}
textarea{width:100%;height:160px;background:#0d1117;color:#e6edf3;border:1px solid #30363d;border-radius:8px;padding:10px}
.saveBtn{margin-top:10px;color:#2f81f7;cursor:pointer;font-weight:700}
</style>

<!-- FIREBASE (MODULE) -->
<script type="module">
/************ FIREBASE SETUP ************/
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAPzgwYDQQqR4y8aRcu8BmXfhYoLPXDuVM",
  authDomain: "forclearpcm.firebaseapp.com",
  projectId: "forclearpcm",
  storageBucket: "forclearpcm.firebasestorage.app",
  messagingSenderId: "313585574692",
  appId: "1:313585574692:web:d4e1262ce22c7cd0bb89b1",
  measurementId: "G-PW32DTYBP8"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/************ LOCK CORE ************/
const OWNER_PASSWORD = "FailMarks";
let OWNER_UNLOCKED = false;
let currentDocPath = null;

function checkLock(){
  OWNER_UNLOCKED = localStorage.getItem("OWNER_UNLOCK") === "YES";
}
function lockOwner(){
  OWNER_UNLOCKED = false;
  localStorage.removeItem("OWNER_UNLOCK");
  render();
}
function unlockOwner(){
  const p = prompt("Owner password");
  if(p === OWNER_PASSWORD){
    OWNER_UNLOCKED = true;
    localStorage.setItem("OWNER_UNLOCK","YES");
    render();
  } else if(p !== null){
    alert("Wrong password");
  }
}

/************ DATA ************/
const syllabus = {
  Maths:{ Calculus:{ Limits:{} } },
  Physics:{},
  Chemistry:{}
};

/************ ENGINE ************/
let stack = [];
let view;
let subjectBtns;

function goSubject(s){ stack=[s]; render(); }

async function render(){
  checkLock();
  subjectBtns.forEach(b=>b.classList.toggle("active", b.dataset.sub===stack[0]));
  view.innerHTML="";

  if(stack.length===0){ view.innerHTML="<h2>Select a subject</h2>"; return; }

  const data = syllabus[stack[0]];
  Object.keys(data).forEach(k=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerText=k;
    d.onclick=()=>renderLeaf(k);
    view.appendChild(d);
  });
}

async function renderLeaf(title){
  view.innerHTML=`<h2>${title}</h2>`;
  currentDocPath = `content/${stack[0]}_${title}`;

  let savedText = "";
  const snap = await getDoc(doc(db, currentDocPath));
  if(snap.exists()) savedText = snap.data().text || "";

  if(OWNER_UNLOCKED){
    view.innerHTML += `
      <textarea id="editor">${savedText}</textarea>
      <div class="saveBtn" id="saveBtn">Save to Firestore</div>
      <div class="saveBtn" onclick="lockOwner()">Lock editing</div>
    `;

    document.getElementById("saveBtn").onclick = async ()=>{
      const text = document.getElementById("editor").value;
      await setDoc(doc(db, currentDocPath), { text, updatedAt: Date.now() });
      alert("Saved successfully");
    };

  } else {
    view.innerHTML += `<div id="lockBadge">ðŸ”’ Editing Locked</div>`;
    if(savedText) view.innerHTML += `<pre style="margin-top:12px">${savedText}</pre>`;
  }
}

/************ INIT ************/
window.addEventListener("DOMContentLoaded",()=>{
  localStorage.removeItem("OWNER_UNLOCK");
  OWNER_UNLOCKED=false;

  view=document.getElementById("view");
  subjectBtns=document.querySelectorAll(".subject-btn");
  subjectBtns.forEach(b=>b.onclick=()=>goSubject(b.dataset.sub));

  const footer=document.getElementById("footerTrigger");
  let lastTap=0;
  footer.addEventListener("mousedown",e=>e.preventDefault());
  footer.addEventListener("touchstart",e=>e.preventDefault(),{passive:false});

  const handleTap=()=>{
    const now=Date.now();
    if(now-lastTap<350) unlockOwner();
    lastTap=now;
  };
  footer.addEventListener("click",handleTap);
  footer.addEventListener("touchend",handleTap);

  render();
});
</script>
</head>
<body>
<header>
  <h1 class="brand">For clear PCM</h1>
  <p class="subtitle">Structured JEE learning</p>
</header>
<div class="subject-bar">
  <div class="subject-btn" data-sub="Maths">Maths</div>
  <div class="subject-btn" data-sub="Physics">Physics</div>
  <div class="subject-btn" data-sub="Chemistry">Chemistry</div>
</div>
<main><div id="view"></div></main>
<footer id="footerTrigger">Â©2026 Terminal Joint Â· For Clear PCM</footer>
</body>
</html>
