<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>For Clear PCM – Ultra Deep JEE Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0d1117;--panel:#161b22;--border:#30363d;
  --text:#e6edf3;--muted:#9aa4af;--accent:#2f81f7;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter,system-ui;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column;font-size:13px}
header{padding:10px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.brand{font-size:1.2rem;font-weight:800}
.tag{font-size:.7rem;color:var(--muted)}
#editorBadge{display:none;background:#238636;color:#fff;padding:3px 8px;border-radius:999px;font-size:.6rem;font-weight:600}
main{flex:1;display:flex;justify-content:center;overflow:auto}
.app{width:100%;max-width:900px;padding:12px}
.step{margin-bottom:14px}
.step-title{font-size:.75rem;color:var(--muted);margin-bottom:6px}
.grid{display:flex;flex-wrap:wrap;gap:6px}
button{background:var(--panel);border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:8px;font-size:.75rem;cursor:pointer}
button:hover{border-color:var(--accent)}
button.active{border-color:var(--accent);color:var(--accent)}
.editor{margin-top:18px}
textarea,select{width:100%;background:var(--panel);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:8px;font-size:.75rem}
textarea{min-height:220px;line-height:1.5}
.meta{font-size:.65rem;color:var(--muted);margin-bottom:6px}
#loginBox{max-width:260px;margin:40px auto;padding:14px;border:1px solid var(--border);border-radius:12px;background:var(--panel)}
#loginBox h2{font-size:.9rem;text-align:center;margin-bottom:6px}
#loginBox p{font-size:.7rem;color:var(--muted);text-align:center;margin-bottom:10px}
footer{border-top:1px solid var(--border);padding:6px;text-align:center;font-size:.6rem;color:var(--muted)}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ================= FIREBASE INIT ================= */
const firebaseConfig={apiKey:"AIzaSyAPzgwYDQQqR4y8aRcu8BmXfhYoLPXDuVM",authDomain:"forclearpcm.firebaseapp.com",projectId:"forclearpcm",storageBucket:"forclearpcm.firebasestorage.app",messagingSenderId:"313585574692",appId:"1:313585574692:web:d4e1262ce22c7cd0bb89b1"};
const appFB = initializeApp(firebaseConfig);
const auth = getAuth(appFB);
const provider = new GoogleAuthProvider();
const db = getFirestore(appFB);

const OWNER_UIDS=["NbJq7HLBt0Pd7O55f4u82HTWOyu2","4MXKQ1JnnIUARfdYlIUbD0Q4erD2"];

/* ================= SYLLABUS (OPTIMIZED ULTRA-DEEP JEE STRUCTURE) ================= */
const syllabus = {
  Maths:{
    Sets_and_Relations:{
      Sets:{Definition:{},Representation:{Roster_Form:{},Set_Builder_Form:{}},Types:{Empty_Set:{},Singleton_Set:{},Finite_Set:{},Infinite_Set:{}},Subsets:{Proper:{},Improper:{},Power_Set:{}},Operations:{Union:{},Intersection:{},Difference:{},Complement:{}},Laws:{De_Morgan_First:{},De_Morgan_Second:{}}},
      Relations:{Ordered_Pairs:{},Cartesian_Product:{},Types:{Reflexive:{},Symmetric:{},Transitive:{},Equivalence:{}},Functions:{Domain:{},Codomain:{},Range:{},Types:{One_One:{},Onto:{},Into:{},Bijective:{}}}}
    },
    Algebra:{
      Quadratic_Equations:{Standard_Form:{},Roots:{Nature:{},Discriminant:{}},Graphs:{}},
      Sequences_and_Series:{AP:{Nth_Term:{},Sum:{}},GP:{Nth_Term:{},Sum:{},Infinite_GP:{}},HP:{}},
      Permutations_and_Combinations:{},
      Binomial_Theorem:{},
      Complex_Numbers:{},
      Matrices_and_Determinants:{},
      Probability:{}
    },
    Coordinate_Geometry:{Straight_Lines:{},Circles:{},Parabola:{},Ellipse:{},Hyperbola:{}},
    Calculus:{Limits:{},Continuity:{},Differentiation:{},Applications_of_Derivatives:{},Integration:{},Differential_Equations:{}},
    Vectors_and_3D:{Vectors:{},Three_D_Geometry:{}}
  },
  Physics:{
    Kinematics:{One_D:{},Two_D:{}},
    Laws_of_Motion:{},
    Work_Energy_Power:{},
    Rotational_Motion:{},
    Gravitation:{},
    Thermodynamics:{},
    Oscillations_and_Waves:{},
    Electrostatics:{},
    Current_Electricity:{},
    Magnetism_and_Matter:{},
    Electromagnetic_Induction:{},
    Alternating_Current:{},
    Optics:{Ray_Optics:{},Wave_Optics:{}},
    Modern_Physics:{Dual_Nature:{},Atoms_and_Nuclei:{},Semiconductors:{}}
  },
  Chemistry:{
    Physical:{Mole_Concept:{},Thermodynamics:{},Chemical_Kinetics:{},Electrochemistry:{},Solutions:{},Surface_Chemistry:{}},
    Inorganic:{Periodic_Table:{},Chemical_Bonding:{},s_Block:{},p_Block:{},d_f_Block:{},Coordination_Compounds:{}},
    Organic:{GOC:{},Hydrocarbons:{},Haloalkanes_and_Haloarenes:{},Alcohols_Phenols_Ethers:{},Aldehydes_Ketones_Carboxylic_Acids:{},Amines:{},Biomolecules:{},Polymers:{},Chemistry_in_Everyday_Life:{}}
  }
};

/* ================= STATE ================= */
let OWNER=false;
let path=[];
const app=document.getElementById('app');

/* ================= DATA ================= */
async function loadNode(p){
  if(!p.length) return null;
  const ref=doc(db,'syllabus',p[0]);
  const snap=await getDoc(ref);
  return snap.exists()?snap.data().nodes?.[p.join('/')]||null:null;
}
async function saveNode(p,content,status){
  const ref=doc(db,'syllabus',p[0]);
  await setDoc(ref,{nodes:{[p.join('/')]:{content,status}}},{merge:true});
}

/* ================= UI ================= */
function getNodeFromPath(){
  let n=syllabus;
  for(const k of path){ if(!n[k]) return null; n=n[k]; }
  return n;
}

async function render(){
  app.innerHTML='';
  let current=syllabus;
  let labels=['Select Subject','Select Chapter','Select Topic','Select Subtopic','Select Concept'];
  let level=0;

  while(current && typeof current==='object' && Object.keys(current).length){
    const step=document.createElement('div');step.className='step';
    const title=document.createElement('div');title.className='step-title';title.innerText=labels[level]||'Select';
    const grid=document.createElement('div');grid.className='grid';

    Object.keys(current).forEach(k=>{
      const b=document.createElement('button');b.innerText=k;
      if(path[level]===k) b.classList.add('active');
      b.onclick=()=>{ path=path.slice(0,level); path[level]=k; render(); };
      grid.appendChild(b);
    });

    step.appendChild(title); step.appendChild(grid); app.appendChild(step);
    if(!path[level]) return;
    current=current[path[level]]; level++;
  }

  // terminal
  const data = await loadNode(path) || {content:'',status:'empty'};
  const ed=document.createElement('div'); ed.className='editor';
  ed.innerHTML=`<div class='meta'>Status: ${data.status}</div>`;

  if(OWNER){
    const sel=document.createElement('select');
    ['empty','draft','done','revised'].forEach(s=>{
      const o=document.createElement('option'); o.value=o.text=s; if(s===data.status) o.selected=true; sel.appendChild(o);
    });
    const ta=document.createElement('textarea'); ta.value=data.content;
    ta.oninput=()=>saveNode(path,ta.value,sel.value);
    sel.onchange=()=>saveNode(path,ta.value,sel.value);
    ed.appendChild(sel); ed.appendChild(ta);
  } else {
    ed.innerHTML += data.content ? `<pre>${data.content}</pre>` : `<div class='meta'>No content yet</div>`;
  }
  app.appendChild(ed);
}

/* ================= AUTH ================= */
onAuthStateChanged(auth,user=>{
  OWNER = !!user && OWNER_UIDS.includes(user.uid);
  document.getElementById('editorBadge').style.display = OWNER ? 'inline-block' : 'none';
  document.getElementById('loginBox').style.display = user ? 'none' : 'block';
  document.getElementById('logoutBtn').style.display = user ? 'block' : 'none';
  render();
});

// expose login/logout safely
window.loginGoogle = () => signInWithPopup(auth,provider);
window.logoutGoogle = () => signOut(auth);

render();
</script>
</head>
<body>
<header>
  <div>
    <div class="brand">For Clear PCM</div>
    <div class="tag">Ultra‑deep JEE knowledge system</div>
  </div>
  <div id="editorBadge">EDITOR</div>
</header>

<main>
  <div class="app" id="app"></div>
</main>

<div id="loginBox">
  <h2>Owner Login</h2>
  <p>Google access only</p>
  <button onclick="loginGoogle()">Sign in with Google</button>
</div>

<button id="logoutBtn" onclick="logoutGoogle()" style="display:none;margin:12px">Logout</button>
<footer>©2026 Terminal Joint · For Clear PCM</footer>
</body>
</html>
